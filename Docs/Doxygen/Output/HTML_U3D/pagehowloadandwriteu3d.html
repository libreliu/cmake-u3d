<HTML>
<HEAD>
<TITLE>Universal 3D:Universal 3D: How To Load &amp; Write U3D</TITLE>
<meta name = "description" content = "">
<meta name = "keywords" content = "">
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<link href="U3D.css" rel="stylesheet" type="text/css">
</HEAD>
<BODY bgcolor="#eeeeee">
<A NAME="#top">

<TABLE WIDTH="100%" CELLPADDING="0" CELLSPACING="0"  BORDER="0">
<TR>
 <TD COLSPAN="2" BACKGROUND="ImagesCommon/top.gif"><IMG SRC="ImagesCommon/top_left.gif" WIDTH="31" HEIGHT="15"></TD>
 <TD COLSPAN="2" BACKGROUND="ImagesCommon/top.gif"></TD>
 <TD COLSPAN="1" WIDTH="100" ><IMG SRC="ImagesCommon/top_right.gif" HEIGHT="15" ></TD>
</TR>
<TR>
  <TD BGCOLOR="#0033ff" WIDTH="31"><TABLE WIDTH="31" CELLPADDING="0" CELLSPACING="0"  BORDER="0"></TABLE></TD>
  <TD WIDTH = "18" VALIGN="top"  ><IMG SRC="ImagesCommon/nav_spacer.gif" BORDER="0" ></TD>
  <TD WIDTH="*" BACKGROUND="ImagesCommon/yellowback2.gif" VALIGN="top" >
  <TABLE WIDTH="290" CELLPADDING="0" CELLSPACING="0"  BORDER="0"></TABLE>
<A class="qindex" href="index.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> main</FONT></B></A>
<A class="qindex" href="hierarchy.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> hierarchy</FONT></B></A>
<A class="qindex" href="annotated.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> annotated types</FONT></B></A>
<A class="qindex" href="classes.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> type index</FONT></B></A>
<A class="qindex" href="functions.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> functions</FONT></B></A>
<A class="qindex" href="globals.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> globals</FONT></B></A>
<A class="qindex" href="files.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> files</FONT></B></A>
<A class="qindex" href="dirs.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> directories</FONT></B></A>
<A class="qindex" href="pages.html"><IMG ALIGN="middle" SRC="ImagesCommon/bullet.gif" BORDER="0"><B><FONT SIZE=-1 FACE="arial" COLOR="#315AFF"> related pages</FONT></B></A>
</TD>
  <TD  WIDTH="*" VALIGN="top" ALIGN="left" BACKGROUND="ImagesCommon/logospacer.gif"><IMG SRC="ImagesCommon/logo_spacer.gif" WIDTH="22" HEIGHT="52"></TD>
  <TD  WIDTH="100" VALIGN="top" ALIGN="right" ><A HREF="http://sourceforge.net/projects/u3d/"><IMG SRC="ImagesCommon/logo.gif"  HEIGHT="52" BORDER="0"></A></TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" CELLPADDING="0" CELLSPACING="0"  BORDER="0">
<TR>
<TD WIDTH="39" BACKGROUND="ImagesCommon/left2.gif"  align="left"></TD>
<TD WIDTH="10" BGCOLOR="#eeeeee"></TD>
<TD WIDTH="*" BGCOLOR="#eeeeee">
<BR>
<!-- Generated by Doxygen 1.4.4 -->
<h1><a class="anchor" name="PageHowLoadAndWriteU3D">How To Load &amp; Write U3D</a></h1>This page describes some common procedures for how to load and write U3D files.<p>
<hr>
 <h2><a class="anchor" name="SectionLoadingAFile">
Loading a File</a></h2>
This section describes the process of loading a file. Here is a brief overview and diagram:<ol type=1>
<li>Create and setup a Read Buffer component</li><li>Create and setup a Load Manager component</li><li>Call <code>pLoadManager-&gt;Load()</code> </li></ol>
<p>
<div align="center">
<img src="DiagramLoadFile.png" alt="DiagramLoadFile.png">
</div>
<h3><a class="anchor" name="SectionLoadingStep1">
Loading:  ReadBuffer</a></h3>
1. Create and setup a Read Buffer component<ul>
<li><code><a class="el" href="class_i_f_x_read_buffer_x.html">IFXReadBufferX</a></code> interface abstracts underlying file system</li><li>Available read buffer objects<ul>
<li>Stdio Read Buffer wraps <code>fread</code>, <code>fopen</code> (<code>CID_IFXStdioReadBufferX</code>, implemented by <code><a class="el" href="class_c_i_f_x_stdio_read_buffer_x.html">CIFXStdioReadBufferX</a></code>)</li><li>Internet Read Buffer wraps Internet usage (<code>CID_IFXInternetReadBuffer</code>, implemented by <code><a class="el" href="class_c_i_f_x_internet_read_buffer_x.html">CIFXInternetReadBufferX</a></code>)</li><li><code><a class="el" href="class_c_i_f_x_data_block_x.html">CIFXDataBlockX</a></code> wraps <code>memcpy</code> (<code>CID_IFXDataBlockX</code>)</li></ul>
</li></ul>
<h3><a class="anchor" name="SectionLoadingStep2">
Loading:  Load Manager</a></h3>
2. Create and setup a Load Manager component<ul>
<li>Main interface is <code><a class="el" href="class_i_f_x_load_manager.html">IFXLoadManager</a></code> (<code>CID_IFXLoadManager</code>, implemented by <code><a class="el" href="class_c_i_f_x_load_manager.html">CIFXLoadManager</a></code>)</li><li>Load Manager initialized with reference to Core Services interface <a class="el" href="class_i_f_x_core_services.html">IFXCoreServices</a> (<code>CID_IFXCoreServices</code>, implemented by <code><a class="el" href="class_c_i_f_x_core_services.html">CIFXCoreServices</a></code>)<ul>
<li>Core Services provides access to common services such as the scene graph, palettes, scheduler, name map, ...</li></ul>
</li></ul>
<h3><a class="anchor" name="SectionLoadingStep3">
Loading:  Call Load</a></h3>
3. Call the Load Manager's Load function<ul>
<li><code><a class="el" href="class_i_f_x_load_manager.html#a1">IFXLoadManager::Load</a></code> parameters<ul>
<li><code>pReadBuffer</code> – Interface pointer to buffer to load from</li><li><code>atomicLoad</code> - Specify if load should be atomic or non-atomic and sectioned<ul>
<li>For atomic loading, Load Manager will attempt to load the entire buffer before returning (if possible, depends upon Read Buffer type)</li><li>For non-atomic loading, Load Manager will schedule the load with the Scheduler (if available) and return</li></ul>
</li><li><code>scope</code> - Specify scope identification string used for name collision resolution during the load depending upon the policy specified</li><li><code>collisionPolicy</code> - Specify the object name collision resolution policy of type IFXCollisionPolicy:<ul>
<li>Replace old with new</li><li>Keep old and discard new</li><li>Prepend scope string (always or on collision only)</li><li>Append sequence number on collision</li></ul>
</li></ul>
</li></ul>
<h3><a class="anchor" name="SectionLoadingSample">
Sample:  Load Manager</a></h3>
Here is a simple code example with no error checking:<p>
<div class="fragment"><pre class="fragment"><span class="comment">// Create Load Manager and get main interface</span>
<a class="code" href="class_i_f_x_load_manager.html">IFXLoadManager</a> *pLM = <a class="code" href="_i_f_x_data_types_8h.html#a2">NULL</a>;
<a class="code" href="_i_f_x_smart_ptr_8h.html#a0">IFXCreateComponent</a>( CID_IFXLoadManager, IID_IFXLoadManager, ( <span class="keywordtype">void</span>** ) &amp;pLM ); 

<span class="comment">// Initialize Load Manager with Core Services</span>
pLM-&gt;<a class="code" href="class_i_f_x_load_manager.html#a0">Initialize</a>( pCoreServices );

<span class="comment">// Create Read Buffer and get buffer interface</span>
<a class="code" href="class_i_f_x_read_buffer_x.html">IFXReadBufferX</a> *pRB = <a class="code" href="_i_f_x_data_types_8h.html#a2">NULL</a>;
<a class="code" href="_i_f_x_smart_ptr_8h.html#a0">IFXCreateComponent</a>( CID_IFXStdioReadBufferX, IID_IFXReadBufferX, ( <span class="keywordtype">void</span>** ) &amp;pRB );

<span class="comment">// Get IFXStdio interface</span>
<a class="code" href="class_i_f_x_stdio.html">IFXStdio</a> *pStdio = <a class="code" href="_i_f_x_data_types_8h.html#a2">NULL</a>;
pRB-&gt;<a class="code" href="class_i_f_x_unknown.html#a2">QueryInterface</a>( IID_IFXStdio, ( <span class="keywordtype">void</span>** ) &amp;pStdio );

 <span class="comment">// Open file</span>
pStdio-&gt;Open( pFileName );

<span class="comment">// Load file</span>
pLM-&gt;<a class="code" href="class_i_f_x_load_manager.html#a1">Load</a>( 
        pRB,        <span class="comment">// Load information from this Read Buffer</span>
        loadAtomic, <span class="comment">// Attempt to load all at once?</span>
        <span class="stringliteral">"myScope"</span>,  <span class="comment">// Scope used for names collision resolution</span>
        <a class="code" href="_i_f_x_file_reference_8h.html#a10a4">IFXCOLLISIONPOLICY_PREPENDALL</a> ); <span class="comment">// Policy used for handling object names   </span>
</pre></div><p>
<hr>
 <h2><a class="anchor" name="SectionWritingAFile">
Writing a File</a></h2>
This section describes the process of writing a file. Here is a brief overview and diagram:<ol type=1>
<li>Create the scene</li><li>Mark objects for writing</li><li>Create and setup Write Manager</li><li>Create and setup Write Buffer object</li><li>Call <code>pWriteManager-&gt;Write()</code> </li></ol>
<p>
<div align="center">
<img src="DiagramWriteFile.png" alt="DiagramWriteFile.png">
</div>
<h3><a class="anchor" name="SectionWritingStep1">
Writing:  Create Scene</a></h3>
1. Create the scene<ul>
<li>By creating objects and adding them to the palettes</li><li>By loading other files</li></ul>
<h3><a class="anchor" name="SectionWritingStep2">
Writing:  Mark</a></h3>
2. Mark objects for writing<ul>
<li>Marking is done using the <code><a class="el" href="class_i_f_x_marker_x.html">IFXMarkerX</a></code> interface</li><li>Marking is recursive and all objects used by that object are also marked</li><li>Also use marking interface to<ul>
<li>Set quality factors (quantization levels)<ul>
<li>Quality factors can also be set using Write Manager</li></ul>
</li><li>Set block priority<ul>
<li>Priority setting can be recursive or not</li></ul>
</li></ul>
</li></ul>
<p>
Marked objects are depicted in the diagram with an asterick (*).<h3><a class="anchor" name="SectionWritingStep3">
Writing:  Write Manager</a></h3>
3. Create and setup Write Manager<ul>
<li>Main interface is <code><a class="el" href="class_i_f_x_write_manager.html">IFXWriteManager</a></code> (<code>CID_IFXWriteManager</code>, implemented by <code><a class="el" href="class_c_i_f_x_write_manager.html">CIFXWriteManager</a></code>)</li><li>Write Manager initialized with Core Services (<code>CID_IFXCoreServices</code>, implemented by <code><a class="el" href="class_c_i_f_x_core_services.html">CIFXCoreServices</a></code>)<ul>
<li>Similar to Load Manager for the same reasons</li></ul>
</li></ul>
<h3><a class="anchor" name="SectionWritingStep4">
Writing:  Write Buffer</a></h3>
4. Create and setup Write Buffer object<ul>
<li><code><a class="el" href="class_i_f_x_write_buffer_x.html">IFXWriteBufferX</a></code> interface abstracts underlying file system</li><li>Available write buffer objects<ul>
<li>Stdio Write Buffer wraps <code>fwrite</code>, <code>fopen</code> (<code>CID_IFXStdioWriteBufferX</code>, implemented by <code><a class="el" href="class_c_i_f_x_stdio_write_buffer_x.html">CIFXStdioWriteBufferX</a></code>)</li><li><code><a class="el" href="class_c_i_f_x_data_block_x.html">CIFXDataBlockX</a></code> wraps <code>memcpy</code> (<code>CID_IFXDataBlockX</code>)</li></ul>
</li></ul>
<h3><a class="anchor" name="SectionWritingStep5">
Writing:  Write</a></h3>
5. Call <code>pWriteManager-&gt;Write()</code> <ul>
<li><code><a class="el" href="class_i_f_x_write_manager.html#a1">IFXWriteManager::Write</a></code> parameters<ul>
<li><code>pWriteBuffer</code> – Interface pointer to buffer to write to</li><li><code>exportOptions</code> – Specify which palettes should be written</li></ul>
</li><li>Only objects that have been marked and are in palettes selected by <code>exportOptions</code> are written to the write buffer</li></ul>
<h3><a class="anchor" name="SectionWritingSample">
Sample:  Write Manager</a></h3>
Here is a simple code example with no error checking:<p>
<div class="fragment"><pre class="fragment"><span class="comment">// Create Write Manager and get main interface</span>
<a class="code" href="class_i_f_x_write_manager.html">IFXWriteManager</a> *pWM = <a class="code" href="_i_f_x_data_types_8h.html#a2">NULL</a>;
<a class="code" href="_i_f_x_smart_ptr_8h.html#a0">IFXCreateComponent</a>( CID_IFXWriteManager, IID_IFXWriteManager, ( <span class="keywordtype">void</span>** ) &amp;pWM );

<span class="comment">// Initialize Write Manager with Core Services</span>
pWM-&gt;<a class="code" href="class_i_f_x_write_manager.html#a0">Initialize</a>( pCoreServices );

<span class="comment">// Create Write Buffer and get buffer interface</span>
<a class="code" href="class_i_f_x_write_buffer_x.html">IFXWriteBufferX</a> *pWB = <a class="code" href="_i_f_x_data_types_8h.html#a2">NULL</a>;
<a class="code" href="_i_f_x_smart_ptr_8h.html#a0">IFXCreateComponent</a>( CID_IFXStdioWriteBufferX, IID_IFXWriteBufferX, ( <span class="keywordtype">void</span>** ) &amp;pWB );

<span class="comment">// Get IFXStdio interface</span>
<a class="code" href="class_i_f_x_stdio.html">IFXStdio</a> *pStdio = <a class="code" href="_i_f_x_data_types_8h.html#a2">NULL</a>;
pWB-&gt;<a class="code" href="class_i_f_x_unknown.html#a2">QueryInterface</a>( IID_IFXStdio, ( <span class="keywordtype">void</span>** ) &amp;pStdio );

 <span class="comment">// Open file</span>
pStdio-&gt;Open( pFileName );

<span class="comment">// Mark all Scene Graph resources</span>
pSceneGraph-&gt;Mark();

<span class="comment">// Write the file</span>
pWM-&gt;<a class="code" href="class_i_f_x_write_manager.html#a1">Write</a>( pWB, <a class="code" href="_i_f_x_export_options_8h.html#a12a11">IFXEXPORT_EVERYTHING</a> );

<span class="comment">// Close buffer</span>
pStdio-&gt;Close();    
</pre></div><p>
<hr>
 <h2><a class="anchor" name="SectionRelatedInformation">
Related Information</a></h2>
<ul>
<li><a class="el" href="pageusage.html">Usage</a></li><li><a class="el" href="pagehowmakeclodmesh.html">How To Make A CLOD Mesh</a></li><li><a class="el" href="pagesoftwarecontents.html#SectionExampleApplications">Example Applications</a></li><li><a class="el" href="pagecodingconventionsifxcom.html">IFXCOM Coding Conventions</a> </li></ul>
<P>

<TABLE CELLPADDING="0" CELLSPACING="0" BORDER="0">
 <TR><TD>
 <FONT SIZE="-2" FACE="arial"><I>&#169; 1999 - 2006 Intel Corporation. All rights reserved.<BR><BR>
 * Other names and brands may be claimed as the property of others.</I></FONT>
 </TD></TR>
</TABLE>

<TABLE WIDTH="100%" CELLPADDING="0" CELLSPACING="0" BORDER="0">
<TR>
<TD WIDTH="18"><IMG SRC="ImagesCommon/footer1.gif" HEIGHT="45" BORDER="0"></TD>
<TD WIDTH="5" ><IMG SRC="ImagesCommon/footer2.gif" WIDTH="5" HEIGHT="45" BORDER="0"></TD>
<TD WIDTH="28"><IMG SRC="ImagesCommon/footer3.gif" HEIGHT="45" BORDER="0"></TD>
<TD BACKGROUND="ImagesCommon/footer4.gif" WIDTH="*"><IMG SRC="ImagesCommon/footer4.gif" HEIGHT="45" BORDER="0"></TD>
<TD WIDTH="26"><IMG SRC="ImagesCommon/footer5.gif" HEIGHT="45" BORDER="0"></TD>
</TR>
<TR><TD COLSPAN="5"></TD></TR>
</TABLE>


